# Cursor AI Rules for EMIS Project

## ğŸš¨ CRITICAL: File Organization

### Root Directory - KEEP CLEAN
**NEVER create files in the project root except:**
- Core documentation: README.md, CHANGELOG.md, CONTRIBUTING.md, LICENSE, SECURITY.md
- Quick reference: QUICK_REFERENCE.md
- Configuration: .gitignore, .env.example, docker-compose.yml

**FORBIDDEN in root:**
- âŒ Test reports
- âŒ Implementation reports
- âŒ Progress updates
- âŒ Temporary files
- âŒ Debug logs
- âŒ Test scripts

### Development Reports - MANDATORY LOCATION
**ALL development reports MUST go to:** `.factory/development-reports/`

**REQUIRED filename format:**
```
YYYY-MM-DD-descriptive-kebab-case-title.md
```

**Examples:**
- âœ… `.factory/development-reports/2025-11-06-session-optimization.md`
- âœ… `.factory/development-reports/2025-11-07-search-functionality-fix.md`
- âŒ `PHASE_1_RESULTS.md` (wrong location, wrong format)
- âŒ `test_report.md` (wrong location, wrong format)
- âŒ `.factory/development-reports/Report.md` (missing date)

### Test Scripts - TEMPORARY ONLY
**Create in:** `backend/` or appropriate subdirectory
**Name with prefix:** `test_`, `debug_`, `inspect_`, `check_`, `explore_`
**Delete when done:** These are TEMPORARY - remove after debugging

---

## ğŸ“ File Creation Checklist

Before creating ANY file:
1. âœ… Check parent directory exists (use LS tool)
2. âœ… Verify correct location based on file type
3. âœ… Use proper naming convention
4. âœ… Never drop files in root unless core documentation

**File type locations:**
- Reports â†’ `.factory/development-reports/`
- Specs â†’ `.factory/specs/`
- User docs â†’ `docs/`
- Internal docs â†’ `docs/development/`
- Test scripts â†’ `backend/` (temporary)
- Examples â†’ `examples/`

---

## ğŸ”§ Code Modification Rules

### Before Changing Code
1. **READ** existing code to understand patterns
2. **SEARCH** for similar implementations (use Grep/Glob)
3. **MATCH** existing style (indentation, naming, structure)
4. **VERIFY** libraries are already installed

### When Writing Code
- Preserve exact indentation (tabs vs spaces)
- Follow project's existing patterns
- Use already-installed libraries
- Add comments ONLY when necessary (explain "why", not "what")
- Never expose credentials, API keys, or sensitive data

### Project-Specific Code Standards
- **Backend port:** 38153 (not 8000!)
- **Start command:** `python app.py` (not uvicorn)
- **Virtual env:** `backend/venv/`
- **Session data:** `backend/data/sessions/`
- **Site configs:** `backend/sites/*.yaml`

---

## ğŸ§ª Testing Requirements

### Before Completing ANY Task
1. âœ… Run linters (if available)
2. âœ… Run type checks (if available)
3. âœ… Run test suite (if available)
4. âœ… Fix ALL errors and warnings
5. âœ… Review system reminder diagnostics

### Finding Test Commands
```bash
# Check for test scripts
cat package.json | grep test
cat Makefile | grep test
ls backend/ | grep test

# Common Python test commands
pytest
pylint src/
mypy src/
ruff check
```

### Manual Verification
```bash
# Backend testing
cd backend
./scrape list
./scrape query emis "test"
python app.py  # Should start on port 38153

# API testing
curl http://localhost:38153/
curl http://localhost:38153/sites
```

---

## ğŸ”’ Security Requirements

### Before EVERY Git Commit
**MANDATORY security scan:**
1. Run `git diff --cached` - review ALL changes
2. Run `git status` - confirm all files
3. **Scan for sensitive data:**
   - API keys, passwords, tokens
   - Email addresses in config
   - Database credentials
   - Internal URLs
   - Session data
4. Check `.env` files, logs, config files
5. **If found:** STOP and warn user immediately

### Credential Handling
- âœ… Use `.env` files (gitignored)
- âœ… Provide `.env.example` templates
- âœ… Document required env vars in README
- âŒ Never commit real credentials
- âŒ Never expose secrets in logs
- âŒ Never commit `.env` files

---

## ğŸ“ Git Workflow

### Pre-commit Checklist
1. `git status` - see what's being committed
2. `git diff` - review all changes
3. Security scan (see above)
4. `git log --oneline -10` - check commit message style

### Commit Message Format
```
type: brief description (1-2 sentences)

Focus on WHY, not WHAT.

Co-authored-by: factory-droid[bot] <138933559+factory-droid[bot]@users.noreply.github.com>
```

### Git Rules
- âŒ Never use `-i` flag (interactive not supported)
- âŒ Never push without explicit user instruction
- âŒ Never update git config
- âœ… Check for pre-commit hooks
- âœ… Amend commit if pre-commit modifies files

---

## ğŸ“Š Development Reports

### When to Create Reports
- Complex multi-step implementations
- Optimization work with metrics
- Test results and findings
- Compatibility analyses
- Architecture decisions

### Report Template
```markdown
# [Feature/Fix Name]

**Date:** YYYY-MM-DD
**Status:** âœ… Complete / ğŸš§ In Progress / âŒ Blocked

## Summary
Brief overview (2-3 sentences)

## Changes Made
- File: `path/to/file.py` - what changed and why
- File: `path/to/other.py` - what changed and why

## Testing
- âœ… Test suite: Passed
- âœ… Manual testing: Verified
- âœ… Performance: Metrics included

## Results
- Key metrics or outcomes
- Performance improvements
- Issues resolved

## Next Steps
- Follow-up tasks (if any)
```

### Report Location
**ALWAYS:** `.factory/development-reports/YYYY-MM-DD-descriptive-title.md`

**Update index:**
`.factory/development-reports/README.md` - add entry to list

---

## ğŸ¯ TODO Management

### When to Use TodoWrite
- Complex multi-step work (3+ steps)
- Non-trivial tasks requiring planning
- User provides multiple tasks
- Tracking implementation progress

### TODO Rules
- Keep only ONE task `in_progress` at a time
- Mark `completed` ONLY when fully done:
  - âœ… Implementation complete
  - âœ… Tests pass
  - âœ… No errors remain
  - âœ… Verification done

### TODO Template
```javascript
[
  {
    "id": "1",
    "content": "Specific actionable task description",
    "status": "pending",  // pending, in_progress, completed
    "priority": "high"    // high, medium, low
  }
]
```

---

## ğŸš€ Performance Guidelines

### Parallel Execution
When possible, call multiple tools simultaneously:
```javascript
// âœ… Good - parallel calls
<function_calls>
  <invoke name="Read">...</invoke>
  <invoke name="Grep">...</invoke>
  <invoke name="TodoWrite">...</invoke>
